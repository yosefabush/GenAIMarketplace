## 2025-01-19 - US-001: Database schema and models

- What was implemented:
  - SQLite database configuration with SQLAlchemy 2.0 ORM
  - Categories table with id, name, slug, parent_id (self-referential for hierarchy), created_at, updated_at
  - Tags table with id, name (unique), created_at
  - Items table with id, title, description, content (markdown), type, category_id, view_count, created_at, updated_at
  - item_tags join table with item_id, tag_id (many-to-many relationship)
  - search_logs table with id, query, result_count, source, created_at
  - Alembic migration setup with initial schema migration
  - FastAPI app structure with main.py and health endpoint

- Files changed:
  - backend/app/models/base.py - SQLAlchemy declarative base
  - backend/app/models/category.py - Category model
  - backend/app/models/tag.py - Tag model
  - backend/app/models/item.py - Item model and item_tags join table
  - backend/app/models/search_log.py - SearchLog model
  - backend/app/models/__init__.py - Model exports
  - backend/app/core/config.py - Pydantic settings
  - backend/app/core/database.py - Database session management
  - backend/app/main.py - FastAPI application
  - backend/alembic/* - Alembic migration configuration
  - backend/alembic/versions/001_initial_schema.py - Initial migration
  - backend/pyproject.toml - Project configuration with mypy settings
  - backend/requirements.txt - Python dependencies

- Learnings for future iterations:
  - Use SQLAlchemy 2.0 Mapped[] type annotations for full type safety
  - Use TYPE_CHECKING imports to avoid circular dependencies between models
  - Pydantic v2 uses model_config = SettingsConfigDict() instead of class Config
  - SQLite requires check_same_thread=False for multi-threaded FastAPI access

---

## 2026-01-19 - US-002: Core API endpoints

- What was implemented:
  - Pydantic schemas for API responses (TagResponse, CategoryResponse, ItemResponse, ItemListResponse)
  - Base response schemas (APIResponse, PaginatedResponse) with generic type support
  - Items router with GET /api/items (paginated list) and GET /api/items/{id} (single item)
  - Categories router with GET /api/categories (list all categories)
  - Tags router with GET /api/tags (list all tags)
  - All endpoints return consistent JSON format with success/data structure
  - Router registration in main.py
  - API documentation available at /docs

- Files changed:
  - backend/app/schemas/base.py - APIResponse and PaginatedResponse schemas
  - backend/app/schemas/tag.py - TagResponse schema
  - backend/app/schemas/category.py - CategoryResponse schema
  - backend/app/schemas/item.py - ItemResponse and ItemListResponse schemas
  - backend/app/schemas/__init__.py - Schema exports
  - backend/app/routers/items.py - Items API router
  - backend/app/routers/categories.py - Categories API router
  - backend/app/routers/tags.py - Tags API router
  - backend/app/routers/__init__.py - Router exports
  - backend/app/main.py - Router registration
  - backend/pyproject.toml - Updated mypy settings for third-party library compatibility

- Learnings for future iterations:
  - Pydantic v2 uses model_config = {"from_attributes": True} instead of orm_mode
  - Use joinedload() from sqlalchemy.orm for eager loading relationships
  - mypy strict mode with ignore_missing_imports still complains about subclassing third-party classes - need disallow_subclassing_any = false
  - FastAPI decorators trigger untyped-decorator errors in strict mode - need disallow_untyped_decorators = false

---

## 2026-01-19 - US-003: Admin CRUD endpoints

- What was implemented:
  - Admin token validation middleware using HTTPBearer from fastapi.security
  - POST /api/items - Create new item with title, description, content, type, category_id, tag_ids
  - PUT /api/items/{id} - Update existing item (partial updates supported)
  - DELETE /api/items/{id} - Delete item by ID
  - POST /api/categories - Create category with name, slug, parent_id (optional)
  - POST /api/tags - Create tag with unique name
  - All admin endpoints return 401 Unauthorized without valid ADMIN_TOKEN in Bearer header
  - Pydantic schemas for create/update operations (ItemCreate, ItemUpdate, CategoryCreate, TagCreate)
  - Proper error handling for duplicate entries (IntegrityError) and invalid foreign keys

- Files changed:
  - backend/app/core/auth.py - Admin token verification using HTTPBearer
  - backend/app/routers/items.py - Added POST, PUT, DELETE endpoints with admin auth
  - backend/app/routers/categories.py - Added POST endpoint with admin auth
  - backend/app/routers/tags.py - Added POST endpoint with admin auth
  - backend/app/schemas/item.py - Added ItemCreate and ItemUpdate schemas
  - backend/app/schemas/category.py - Added CategoryCreate schema
  - backend/app/schemas/tag.py - Added TagCreate schema
  - backend/app/schemas/__init__.py - Exported new schemas

- Learnings for future iterations:
  - Use HTTPBearer for token-based auth in FastAPI (cleaner than manual header parsing)
  - Return underscore-prefixed variable `_: str = Depends(verify_admin_token)` when you need the dependency but not the return value
  - IntegrityError from sqlalchemy.exc handles unique constraint violations
  - Reload item with joinedload after commit to get fully populated relationships in response

---

## 2026-01-19 - US-004: Docker configuration

- What was implemented:
  - Multi-stage Dockerfile with build stage (gcc, wheel generation) and runtime stage (python:3.11-slim)
  - Non-root user (appuser) for security best practices
  - docker-compose.yml with named volume for SQLite persistence
  - Environment variable configuration (ADMIN_TOKEN, PORT, DATABASE_URL)
  - Health check using Python urllib to poll /health endpoint
  - .dockerignore to exclude unnecessary files from build context
  - DOCKER.md comprehensive documentation for building, running, and configuring the container

- Files changed:
  - backend/Dockerfile - Multi-stage build with health check
  - backend/docker-compose.yml - Compose configuration with volume
  - backend/.dockerignore - Build context exclusions
  - backend/DOCKER.md - Deployment documentation

- Learnings for future iterations:
  - Use multi-stage builds to reduce final image size (builder stage for wheels, runtime stage for execution)
  - Create non-root user in Dockerfile for security
  - Use named volumes in docker-compose for data persistence
  - Health check can use Python's urllib as an alternative to curl/wget in slim images
  - .dockerignore should exclude .git, venv, __pycache__, and the Docker files themselves

---

## 2026-01-19 - US-005: SQLite FTS5 full-text search

- What was implemented:
  - FTS5 virtual table (items_fts) using external content table pattern for title, description, content fields
  - INSERT trigger to keep FTS index in sync when items are added
  - UPDATE trigger that deletes old entry and inserts new entry for modified items
  - DELETE trigger to remove entries from FTS index when items are deleted
  - SearchService class with BM25 ranking search method
  - Query preparation with escaping for FTS5 special characters
  - Support for multiple keywords (implicit AND with quoted terms)
  - rebuild_index utility method for FTS index maintenance
  - Fixed pre-existing type errors in items router (reloaded_item assignment)

- Files changed:
  - backend/alembic/versions/002_fts5_search.py - FTS5 virtual table and triggers migration
  - backend/app/services/__init__.py - Services module initialization
  - backend/app/services/search.py - SearchService with FTS5 search implementation
  - backend/app/routers/items.py - Fixed type errors for mypy strict mode

- Learnings for future iterations:
  - FTS5 external content table (content='items', content_rowid='id') stores only index, not data
  - FTS5 UPDATE requires delete of old entry then insert of new entry (no in-place update)
  - BM25 function returns negative values, so ORDER BY bm25() ASC for best matches first
  - Quote each search term to treat as literal and escape FTS5 special characters (" * ^ : ( ) { } -)
  - When reloading an ORM object after commit, use a new variable name to satisfy mypy strict mode
  - Python location on this Windows system: C:\Users\Yosefg\AppData\Local\Programs\Python\Python311\python.exe

---

## 2026-01-19 - US-006: Search API endpoint

- What was implemented:
  - GET /api/search endpoint with query parameter 'q' for full-text search
  - Type filtering: ?type=agent,prompt (comma-separated values)
  - Category filtering: ?category=1,2 (comma-separated category IDs)
  - Tag filtering: ?tags=python,testing (comma-separated tag names with case-insensitive matching)
  - Sort options: relevance (default, uses FTS5 BM25), date, views
  - Page-based pagination: ?page=1&limit=20 (default limit=20, max=100)
  - SearchResponse schema with total count, page, and limit metadata
  - Empty query returns all items sorted by date descending
  - Fixed bug: replaced non-existent ilike_any() with proper or_() + ilike() pattern

- Files changed:
  - backend/app/routers/search.py - Fixed tag filtering SQLAlchemy query

- Learnings for future iterations:
  - SQLAlchemy does NOT have an ilike_any() method - use or_(*[col.ilike(pattern) for pattern in patterns])
  - Import or_ from sqlalchemy for combining multiple conditions
  - Always test that methods actually exist before using them in code
  - Run typecheck (mypy) to verify code compiles - it may not catch runtime method errors on dynamic ORM objects

---

## 2026-01-19 - US-007: Search logging

- What was implemented:
  - SearchLoggingService class with async logging using Python threading
  - log_search() spawns daemon thread for non-blocking database writes
  - _log_search_sync() handles actual database insert in background thread
  - log_search_sync() available for synchronous logging (testing/special cases)
  - All search paths in router log queries (success and failure cases)
  - Failed searches logged with 0 result count as required
  - Silent failure in logging (doesn't affect search functionality)

- Files changed:
  - backend/app/services/search_logging.py - New SearchLoggingService with async logging
  - backend/app/services/__init__.py - Export SearchLoggingService
  - backend/app/routers/search.py - Added logging calls to all return paths

- Learnings for future iterations:
  - Use threading.Thread with daemon=True for fire-and-forget background tasks
  - Create new database session in background thread (don't share across threads)
  - Silent failures in logging are appropriate - logging shouldn't break primary functionality
  - Remember to log at ALL return points, not just the final success path
  - SessionLocal can be imported and used directly for background thread sessions

---

## 2026-01-19 - US-008: React project setup

- What was implemented:
  - React 18 + TypeScript project initialized with Vite (via npm create vite@latest)
  - Tailwind CSS v4 configured with @tailwindcss/vite plugin (v4 uses different config approach)
  - Custom theme with light/dark mode CSS variables in src/index.css using @theme directive
  - Shadcn/ui setup with components.json config, utils.ts, and Button component
  - React Router v6 with createBrowserRouter and RouterProvider pattern
  - Axios API client wrapper with VITE_API_BASE_URL environment variable
  - Path alias @ configured in vite.config.ts and tsconfig.app.json
  - Basic Home and NotFound pages as router placeholders

- Files changed:
  - frontend/ - New React frontend directory
  - frontend/package.json - Project dependencies (React 18, react-router-dom, axios, tailwindcss, shadcn/ui deps)
  - frontend/vite.config.ts - Vite config with React plugin, Tailwind plugin, and path alias
  - frontend/tsconfig.app.json - TypeScript config with path alias for @/*
  - frontend/src/index.css - Tailwind v4 with @theme directive for custom colors
  - frontend/src/main.tsx - Entry point with RouterProvider
  - frontend/src/router.tsx - React Router configuration
  - frontend/src/lib/utils.ts - cn() utility function for class merging
  - frontend/src/lib/api.ts - Axios client with interceptors for auth and error handling
  - frontend/src/components/ui/button.tsx - Shadcn Button component with variants
  - frontend/src/pages/Home.tsx - Placeholder home page
  - frontend/src/pages/NotFound.tsx - 404 page with navigation
  - frontend/components.json - Shadcn/ui configuration
  - frontend/.env, frontend/.env.example - Environment variable templates

- Learnings for future iterations:
  - Tailwind v4 uses @import "tailwindcss" and @theme {} directive instead of tailwind.config.js
  - Tailwind v4 requires @tailwindcss/vite plugin instead of postcss-based setup
  - Tailwind v4 npx tailwindcss init doesn't exist - plugin handles everything
  - Vite environment variables must be prefixed with VITE_ to be exposed to client
  - React Router v6 uses createBrowserRouter() with RouterProvider component
  - Shadcn/ui works with Tailwind v4 but needs manual component setup (no shadcn add command for v4 yet)
  - Always install @radix-ui/react-slot for Button asChild prop support

---

## 2026-01-19 - US-009: Home page layout and search bar

- What was implemented:
  - Homepage with centered hero section and prominent search bar
  - SearchBar component with search icon, large input, and Enter key support
  - TypeFilterChips component with quick filter buttons (All, Agents, Prompts, MCPs, Workflows, Docs)
  - Input UI component following shadcn/ui patterns
  - Search page with sticky header and URL-based state management
  - Responsive layout using Tailwind breakpoints (sm/md) for mobile, tablet, desktop
  - Navigation from home to search page with query parameters

- Files changed:
  - frontend/src/components/SearchBar.tsx - Search input with icon and placeholder
  - frontend/src/components/TypeFilterChips.tsx - Filter chip buttons with toggle states
  - frontend/src/components/ui/input.tsx - Base Input component for forms
  - frontend/src/pages/Home.tsx - Updated homepage with hero section, search bar, type chips
  - frontend/src/pages/Search.tsx - New search page with URL state management
  - frontend/src/router.tsx - Added /search route

- Learnings for future iterations:
  - Use key prop pattern to reset component state when URL params change (avoids useEffect setState anti-pattern)
  - ESLint react-hooks/set-state-in-effect rule prevents calling setState in useEffect - use key-based remount instead
  - Empty interface extends triggers @typescript-eslint/no-empty-object-type - use type alias instead
  - Tailwind v4 responsive classes work same as v3 (sm:, md:, lg: prefixes)
  - URLSearchParams.toString() returns empty string when no params, good for conditional navigation

---

## 2026-01-19 - US-010: Home page recent and featured sections

- What was implemented:
  - ItemCard reusable component with title, type badge (color-coded by type), and truncated description
  - RecentAdditions section fetching 5 most recent items via GET /api/items (sorted by created_at desc)
  - FeaturedItems section fetching popular items via search API sorted by views
  - Loading states with skeleton placeholders and error handling
  - Items link to /items/:id route for navigation to detail page
  - Placeholder ItemDetail page created for route (full implementation in US-013)
  - Responsive grid layout (1 col mobile, 2 col sm, 3 col lg, 5 col xl)

- Files changed:
  - frontend/src/components/ItemCard.tsx - Reusable card component for item previews
  - frontend/src/components/RecentAdditions.tsx - Recent items section with API integration
  - frontend/src/components/FeaturedItems.tsx - Featured/popular items section
  - frontend/src/pages/Home.tsx - Integrated RecentAdditions and FeaturedItems sections
  - frontend/src/pages/ItemDetail.tsx - Placeholder detail page for /items/:id route
  - frontend/src/router.tsx - Added /items/:id route

- Learnings for future iterations:
  - Type badges can use a Record<string, string> for type-to-color mapping with fallback
  - Tailwind's line-clamp-N utility works well for truncating text with ellipsis
  - Featured items can use search API with sort=views as proxy for popularity when no dedicated "featured" field exists
  - Create placeholder pages for routes early to avoid broken links

---

## 2026-01-19 - US-011: Search results display

- What was implemented:
  - SearchResultCard component showing title, type badge, description preview, category, tags (up to 3 with +N overflow), and view count with Eye icon
  - Pagination component with smart page number display (ellipsis for large ranges), prev/next buttons, and responsive text labels
  - Updated Search page with full API integration to /api/search endpoint
  - Loading state with animated spinner during search
  - Error state with styled error message
  - Empty state with SearchX icon and contextual message based on query/filters
  - Results count showing "Showing X-Y of Z results" with query context
  - URL-based pagination state (page param) for shareable/bookmarkable URLs
  - Smooth scroll to top when changing pages

- Files changed:
  - frontend/src/components/SearchResultCard.tsx - New card component for search results with full metadata
  - frontend/src/components/Pagination.tsx - New pagination component with page numbers and navigation
  - frontend/src/pages/Search.tsx - Updated with API integration, loading/error/empty states, results display

- Learnings for future iterations:
  - ESLint react-hooks/set-state-in-effect rule: define async function inside useEffect rather than calling external async function
  - Use cancelled flag pattern in useEffect cleanup to prevent setState on unmounted components
  - Pagination ellipsis logic: show first, last, and pages around current; use "ellipsis" sentinel value for rendering
  - Tag overflow pattern: show first N tags plus "+X" indicator for remaining

---

## 2026-01-20 - US-012: Search filters and sorting

- What was implemented:
  - TypeFilterCheckboxes component with checkboxes for agent/prompt/mcp/workflow/docs types
  - CategoryDropdown component that fetches categories from API and allows single selection
  - TagMultiSelect component with expandable tag list, checkboxes, and clear button
  - SortDropdown component with Relevance/Newest/Most Viewed options
  - FilterSidebar combining all filters with "Clear all" button when filters are active
  - Updated Search page with sidebar layout (desktop: left sidebar, mobile: slide-out panel with overlay)
  - Active filter pills showing current filters with X button to remove
  - URL params for all filters: q, type (comma-separated), category, tags (comma-separated), sort, page
  - Filters apply immediately when changed and reset to page 1
  - Mobile-responsive design with filter toggle button showing active filter count

- Files changed:
  - frontend/src/components/ui/checkbox.tsx - Radix checkbox component
  - frontend/src/components/ui/label.tsx - Radix label component
  - frontend/src/components/ui/select.tsx - Radix select/dropdown component
  - frontend/src/components/TypeFilterCheckboxes.tsx - Type filter with checkboxes
  - frontend/src/components/CategoryDropdown.tsx - Category dropdown with API integration
  - frontend/src/components/TagMultiSelect.tsx - Tag multi-select with expandable list
  - frontend/src/components/SortDropdown.tsx - Sort options dropdown
  - frontend/src/components/FilterSidebar.tsx - Combined filter sidebar component
  - frontend/src/pages/Search.tsx - Integrated filters, sidebar layout, URL state management
  - frontend/package.json - Added @radix-ui/react-checkbox, @radix-ui/react-select, @radix-ui/react-label

- Learnings for future iterations:
  - Radix Select doesn't support multi-select natively; use checkboxes for multi-select functionality
  - Parse and build URL params with dedicated functions for cleaner code
  - Use conditional undefined check (params.category !== undefined) when null is a valid value to distinguish from "not provided"
  - Mobile slide-out sidebar pattern: fixed position, translate-x transform, overlay div for click-to-close
  - Active filter pills improve UX by showing what filters are applied and allowing quick removal

---

## 2026-01-20 - US-013: Item detail page with markdown

- What was implemented:
  - ItemDetail page at /items/:id route with full item display
  - ReactMarkdown rendering for item.content field with prose styling
  - Complete metadata display in header: type badge (color-coded), category name, view count, created date, last updated timestamp
  - Tags displayed as clickable links to search page with tag filter applied
  - Smart back navigation using location.state.from (preserves search context) with fallback to home
  - NotFoundPage component for invalid/missing item IDs (404 handling)
  - LoadingPage with skeleton UI animation during fetch
  - ErrorPage for generic API errors
  - parseItemId helper function for safe ID parsing with null fallback
  - Refactored button.tsx to separate buttonVariants into button-variants.ts to fix react-refresh/only-export-components lint error

- Files changed:
  - frontend/src/pages/ItemDetail.tsx - Full item detail page with markdown, metadata, navigation, 404
  - frontend/src/components/ui/button.tsx - Removed buttonVariants re-export
  - frontend/src/components/ui/button-variants.ts - New file with buttonVariants cva definition

- Learnings for future iterations:
  - React Refresh requires files to only export components; extract non-component exports (like cva variants) to separate .ts files
  - Use location.state.from pattern for contextual back navigation (preserves query params from referring page)
  - Cancelled flag pattern in useEffect for async requests prevents setState on unmounted components
  - Tailwind @tailwindcss/typography plugin provides prose classes for rendered markdown content
  - parseItemId helper with parseInt validation and null fallback handles invalid route params gracefully

---

## 2026-01-20 - US-014: Syntax highlighting and copy buttons

- What was implemented:
  - CodeBlock component with react-syntax-highlighter using Prism for syntax highlighting
  - Copy button positioned at top-right of code blocks with hover visibility (opacity transition)
  - Visual feedback: Check icon and "Copied!" toast appear for 2 seconds after successful copy
  - Language badge displayed next to copy button showing the code language
  - InlineCode component for inline code snippets (no highlighting, just styled)
  - Language alias mapping (js->javascript, py->python, sh->bash, etc.)
  - Integrated with ReactMarkdown via custom components prop
  - Supports all required languages via Prism: Python, JavaScript, TypeScript, JSON, Bash, SQL, YAML, Go, Rust, Java
  - Line numbers shown for code blocks with more than 3 lines
  - Dark/light mode theme detection using document.documentElement.classList

- Files changed:
  - frontend/src/components/CodeBlock.tsx - New component with syntax highlighting and copy
  - frontend/src/pages/ItemDetail.tsx - Updated ReactMarkdown with custom code/pre components
  - frontend/package.json - Added react-syntax-highlighter and @types/react-syntax-highlighter

- Learnings for future iterations:
  - react-syntax-highlighter uses esm imports for styles: import from "dist/esm/styles/prism"
  - ReactMarkdown components prop uses code() function with className containing "language-xxx"
  - Custom pre component should just render children to avoid double wrapper
  - Use not-prose class on CodeBlock wrapper to prevent Tailwind typography prose styles from affecting code
  - navigator.clipboard.writeText() is async and requires try/catch for error handling
